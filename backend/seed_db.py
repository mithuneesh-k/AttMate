import models
from database import SessionLocal, engine
from sqlalchemy.orm import Session
from datetime import date, timedelta
import random
import csv
import io
import re

# Create tables
models.Base.metadata.create_all(bind=engine)

# --- USER PROVIDED DATA ---

CLASSES_DATA = [
    { 'name': '25CSEA'}, { 'name': '25CSEB'}, { 'name': '25CSEC'},
    { 'name': '25CSED'}, { 'name': '25CSEE'}
]

# CSV Format: ROLL_NO,REG_NO,NAME,CLASS
STUDENT_CSV_DATA = """ROLL_NO,REG_NO,NAME,CLASS
25CS001,714025104001,AADHIL YUNIS U,25CSEA
25CS002,714025104002,AARATHANA R,25CSEA
25CS003,714025104003,AASIFKHAN S,25CSEA
25CS004,714025104004,ABHINAYA I,25CSEA
25CS005,714025104005,ABINANDHANA T,25CSEA
25CS006,714025104006,ABINAYA T,25CSEA
25CS007,714025104007,ABISHECK M,25CSEA
25CS008,714025104008,ADITHI MD,25CSEA
25CS009,714025104009,AFNASAFRIN N,25CSEA
25CS010,714025104010,AJAYRATHNAM R,25CSEA
25CS011,714025104011,AKHILESHKAR TP,25CSEA
25CS012,714025104012,AKILESH V,25CSEA
25CS013,714025104013,AKILESHPRIYAN D,25CSEA
25CS014,714025104014,AKSHATHA SP,25CSEA
25CS015,714025104015,AKSHAYA K,25CSEA
25CS016,714025104016,AKSHAYA S,25CSEA
25CS017,714025104017,ALEN KR,25CSEA
25CS018,714025104018,ALSWMITH S,25CSEA
25CS019,714025104019,ANU S,25CSEA
25CS020,714025104020,ANUSHREE M,25CSEA
25CS021,714025104021,ARAVIND S,25CSEA
25CS022,714025104022,ARCHANA R,25CSEA
25CS023,714025104023,ARJUN CHOKKALINGAM K,25CSEA
25CS024,714025104024,ARUN KUMAR S,25CSEA
25CS025,714025104025,ARUNKUMAR C,25CSEA
25CS026,714025104026,ASHLIN A,25CSEA
25CS027,714025104027,ASHWIN KIRBAA B,25CSEA
25CS028,714025104028,ASIMA A,25CSEA
25CS029,714025104029,ASWIN R,25CSEA
25CS030,714025104030,ASWINRAJ K,25CSEA
25CS031,714025104031,ATCHAYA B,25CSEA
25CS032,714025104032,ATCHAYA K,25CSEA
25CS033,714025104033,Ammaiyappan C,25CSEA
25CS034,714025104034,Avanthikaa K V,25CSEA
25CS035,714025104035,BALAMURUGAN M,25CSEA
25CS036,714025104036,BHARANI A,25CSEA
25CS037,714025104037,BHAVANI N,25CSEA
25CS038,714025104038,BHAVATHARANI S,25CSEA
25CS039,714025104039,BRINDHA D,25CSEA
25CS040,714025104040,BRINDHA R,25CSEA
25CS041,714025104041,CHAMELI NAYAHA J,25CSEA
25CS042,714025104042,DANIEL ALEX A,25CSEA
25CS043,714025104043,DANIEL WILLIAM BG,25CSEA
25CS044,714025104044,DARIKA SHRI V,25CSEA
25CS045,714025104045,DARSHAN JB,25CSEA
25CS046,714025104046,DEEKSHA KRITI K,25CSEA
25CS047,714025104047,DEEPADHARANI S,25CSEA
25CS048,714025104048,DEEPAHARINI V,25CSEA
25CS049,714025104049,DEVAN S,25CSEA
25CS050,714025104050,DEVISRI R,25CSEA
25CS051,714025104051,DHANUSHKUMAR R,25CSEA
25CS052,714025104052,DHANUSRI E,25CSEA
25CS053,714025104053,DHANYA SHREE K,25CSEA
25CS054,714025104054,DHARANIKA S,25CSEA
25CS055,714025104055,DHARANISH KUMAR M,25CSEA
25CS056,714025104056,DHARANITHARAN N,25CSEA
25CS057,714025104057,DHARSHAN A,25CSEA
25CS058,714025104058,DHARSHAN B,25CSEA
25CS059,714025104059,DHARSHAN K,25CSEA
25CS060,714025104060,DHARSHINI GG,25CSEA
25CS061,714025104061,DHARSHINI MP,25CSEA
25CS062,714025104062,DHARSHINI S,25CSEA
25CS063,714025104063,DHARSHINI SARAVANAKUMAR,25CSEA
25CS064,714025104064,DHARUN M,25CSEA
25CS065,714025104065,DHARUN VENGADESH N,25CSEB
25CS066,714025104066,DHIYANESHWAR M,25CSEB
25CS067,714025104067,DIVYA SRI M,25CSEB
25CS068,714025104068,ELAMPARITHI P,25CSEB
25CS069,714025104069,GANASRI C,25CSEB
25CS070,714025104070,GIRIVAASAN N S,25CSEB
25CS071,714025104071,GOBIKA D,25CSEB
25CS072,714025104072,GOKUL I,25CSEB
25CS073,714025104073,GOVARTHANAN R,25CSEB
25CS074,714025104074,GOWTHAM L.,25CSEB
25CS075,714025104075,GOWTHAMAN S,25CSEB
25CS076,714025104076,GUNA R,25CSEB
25CS077,714025104077,GUNA SOUNDARYA M,25CSEB
25CS078,714025104078,HARIDHARSHAN J,25CSEB
25CS079,714025104079,HARIHARASUDHAN V S,25CSEB
25CS080,714025104080,HARINI B,25CSEB
25CS081,714025104081,HARINI R,25CSEB
25CS082,714025104082,HARIS ROSHAN M,25CSEB
25CS083,714025104083,HARISH RAJA K,25CSEB
25CS084,714025104084,HARITHAA G,25CSEB
25CS085,714025104085,HARITHARAN G,25CSEB
25CS086,714025104086,HARRIS RONI D,25CSEB
25CS087,714025104087,HARSHINE R,25CSEB
25CS088,714025104088,HARSHINI K,25CSEB
25CS089,714025104089,HARSHITHA B M,25CSEB
25CS090,714025104090,HEMALATHA M,25CSEB
25CS091,714025104091,HENRY JOSHUA J,25CSEB
25CS092,714025104092,INDHU KAVYA P,25CSEB
25CS093,714025104093,INDHU M,25CSEB
25CS094,714025104094,ISAAC DANIEL S,25CSEB
25CS095,714025104095,ISHWARYA A K,25CSEB
25CS096,714025104096,JAI VIKASH A R,25CSEB
25CS097,714025104097,JAMES VASANTHAN E,25CSEB
25CS098,714025104098,JANANI P,25CSEB
25CS099,714025104099,JAYAPRIYA V,25CSEB
25CS100,714025104100,JAYASHREE K J,25CSEB
25CS101,714025104101,JAYASIMHA S,25CSEB
25CS102,714025104102,JAYASREE M,25CSEB
25CS103,714025104103,JEEVA A,25CSEB
25CS104,714025104104,JEEVANANTHAM K,25CSEB
25CS105,714025104105,JEEVINTH M,25CSEB
25CS106,714025104106,JEYASREE B,25CSEB
25CS107,714025104107,KABILASH R,25CSEB
25CS108,714025104108,KALAI SANGAMITHIRAN S K,25CSEB
25CS109,714025104109,KANISHA R S,25CSEB
25CS110,714025104110,KANISHK K S,25CSEB
25CS111,714025104111,KANISHKA M R,25CSEB
25CS112,714025104112,KANISHKA T,25CSEB
25CS113,714025104113,KARISHNI B,25CSEB
25CS114,714025104114,KAVI BARATHI R,25CSEB
25CS115,714025104115,KAVIN K R,25CSEB
25CS116,714025104116,KAVISHNA S,25CSEB
25CS117,714025104117,KAVIYA M,25CSEB
25CS118,714025104118,KEERTHANA R,25CSEB
25CS119,714025104119,KIRUNITH S,25CSEB
25CS120,714025104120,KISHORE S,25CSEB
25CS121,714025104121,KISHORE S P,25CSEB
25CS122,714025104122,KRITHIN T,25CSEB
25CS123,714025104123,LAKSHITHA S,25CSEB
25CS124,714025104124,LAKSHNAS SREE M,25CSEB
25CS125,714025104125,LALITH RAM K,25CSEB
25CS126,714025104126,LAVANYA R,25CSEC
25CS127,714025104127,LITHIKA DB,25CSEC
25CS128,714025104128,LOGESH R,25CSEC
25CS129,714025104129,MAHALAKSHMI B,25CSEC
25CS130,714025104130,MAHASAKTHI S,25CSEC
25CS131,714025104131,MALINI A,25CSEC
25CS132,714025104132,MANIKANDAN N,25CSEC
25CS133,714025104133,MANISH BHARATHI G,25CSEC
25CS134,714025104134,MANISHA S,25CSEC
25CS135,714025104135,MANOJ KUMAR S,25CSEC
25CS136,714025104136,MATHAN KUMAR K,25CSEC
25CS137,714025104137,MATHESH KS,25CSEC
25CS138,714025104138,MATHESH UB,25CSEC
25CS139,714025104139,MAVYASHRI M,25CSEC
25CS140,714025104140,MEENAKSHI C,25CSEC
25CS141,714025104141,MEHAA S,25CSEC
25CS142,714025104142,MEKAJAYA S,25CSEC
25CS143,714025104143,MITHRA S,25CSEC
25CS144,714025104144,MITHUNEESH K,25CSEC
25CS145,714025104145,MOHAMED FAIZAL S,25CSEC
25CS146,714025104146,MOHAMED IRFAN N,25CSEC
25CS147,714025104147,MOHANA KRISHNAN S,25CSEC
25CS148,714025104148,MONISHA M,25CSEC
25CS149,714025104149,MOUNIKA SHREE M,25CSEC
25CS150,714025104150,MUGESH KANNA S,25CSEC
25CS151,714025104151,MUKESH NS,25CSEC
25CS152,714025104152,MURUGAVEL A,25CSEC
25CS153,714025104153,NAKSHATRA SV,25CSEC
25CS154,714025104154,NANDHIKA VANJINAYAKI B,25CSEC
25CS155,714025104155,NAREN A,25CSEC
25CS156,714025104156,NAREN B,25CSEC
25CS157,714025104157,NARMATHA R,25CSEC
25CS158,714025104158,NAVEEN B,25CSEC
25CS159,714025104159,NAVEEN K,25CSEC
25CS160,714025104160,NAVEEN KUMAR SK,25CSEC
25CS161,714025104161,NAVEEN R,25CSEC
25CS162,714025104162,NAVIN R,25CSEC
25CS163,714025104163,NETHRA P,25CSEC
25CS164,714025104164,NETHRA SP,25CSEC
25CS165,714025104165,NETHRA SS,25CSEC
25CS166,714025104166,NETRA V,25CSEC
25CS167,714025104167,NIKIL KARTHIK SA,25CSEC
25CS168,714025104168,NIRANJAN B,25CSEC
25CS169,714025104169,NISHAL S,25CSEC
25CS170,714025104170,NISHANT JR,25CSEC
25CS171,714025104171,NISHANT JS,25CSEC
25CS172,714025104172,NISHANTH C,25CSEC
25CS173,714025104173,NISHANTH KR,25CSEC
25CS174,714025104174,NISHANTH RK,25CSEC
25CS175,714025104175,NISHANTH S,25CSEC
25CS176,714025104176,NITHEESH M,25CSEC
25CS177,714025104177,NITHEESWAR S,25CSEC
25CS178,714025104178,NITHICK SJ,25CSEC
25CS179,714025104179,NITHIN AKASH PS,25CSEC
25CS180,714025104180,NITHIN SB,25CSEC
25CS181,714025104181,NITHISH NARAYANAN C,25CSEC
25CS182,714025104182,NITHIYA SRI K,25CSEC
25CS183,714025104183,NITISH RG,25CSEC
25CS184,714025104184,NIVEDITA R,25CSEC
25CS185,714025104185,NIVETHA KT,25CSEC
25CS186,714025104186,NIVETHA S,25CSEC
25CS187,714025104187,OVIYA RETHANYA S,25CSEC
25CS188,714025104188,PADMANABHAN SURESH BABU S,25CSEC
25CS189,714025104189,PARAMASIVAM A,25CSED
25CS190,714025104190,PARTHIBAN V,25CSED
25CS191,714025104191,PAVINKUMAR R,25CSED
25CS192,714025104192,PAVITHRA N,25CSED
25CS193,714025104193,PIPIN P,25CSED
25CS194,714025104194,POOJA SRI S,25CSED
25CS195,714025104195,PRADEEP M,25CSED
25CS196,714025104196,PRANESH GOVINDHARAJ G,25CSED
25CS197,714025104197,PRAVEEN KUMAR S,25CSED
25CS198,714025104198,PRIADHARSAN AK,25CSED
25CS199,714025104199,PRIJITHA S,25CSED
25CS200,714025104200,PRITHESH M,25CSED
25CS201,714025104201,PRIYA DHARSHINI A,25CSED
25CS202,714025104202,PRIYADHARSHINI G,25CSED
25CS203,714025104203,PRIYADHARSHINI P,25CSED
25CS204,714025104204,PRIYAN S,25CSED
25CS205,714025104205,RACHANAA N,25CSED
25CS206,714025104206,RAGHUNANDAN AR,25CSED
25CS207,714025104207,RAGUL A,25CSED
25CS208,714025104208,RAHUL G,25CSED
25CS209,714025104209,RAHUL KUMAR R,25CSED
25CS210,714025104210,RANJITH S,25CSED
25CS211,714025104211,RESHMA M,25CSED
25CS212,714025104212,RESHMA T,25CSED
25CS213,714025104213,RINSHA SHERIN S,25CSED
25CS214,714025104214,RITHAN S,25CSED
25CS215,714025104215,RITHIKA BS,25CSED
25CS216,714025104216,RITHIKA G,25CSED
25CS217,714025104217,RITHIKA M,25CSED
25CS218,714025104218,RITHIKA R,25CSED
25CS219,714025104219,RITHISH C,25CSED
25CS220,714025104220,ROHITH ANANTHAKUMAR R,25CSED
25CS221,714025104221,ROVAAN KG,25CSED
25CS222,714025104222,SADHANA M,25CSED
25CS223,714025104223,SAMPREETH G,25CSED
25CS224,714025104224,SANDEEP P,25CSED
25CS225,714025104225,SANDHIYA A,25CSED
25CS226,714025104226,SANGEETHA P,25CSED
25CS227,714025104227,SANJAI KRISHNAN K,25CSED
25CS228,714025104228,SANJAY DHURSON V,25CSED
25CS229,714025104229,SANJAY RAM M,25CSED
25CS230,714025104230,SANJAY V,25CSED
25CS231,714025104231,SANJAYSREE T,25CSED
25CS232,714025104232,SANJEEVKUMAR P,25CSED
25CS233,714025104233,SANTHOSH R,25CSED
25CS234,714025104234,SARAN S,25CSED
25CS235,714025104235,SARANYA M,25CSED
25CS236,714025104236,SARVESWARAN VA,25CSED
25CS237,714025104237,SASITHARAN K,25CSED
25CS238,714025104238,SATHYA SARAN A,25CSED
25CS239,714025104239,SHAHANA AR,25CSED
25CS240,714025104240,SHANMATHI S,25CSED
25CS241,714025104241,SHARMITHA C,25CSED
25CS242,714025104242,SHIVARAKKSHANA S,25CSED
25CS243,714025104243,SHREE NITHI GOBIKA S,25CSED
25CS244,714025104244,SHRI HARI VISHNU S,25CSED
25CS245,714025104245,SHRIHARIVARSHAN S,25CSED
25CS246,714025104246,SHRINIVAAS SB,25CSED
25CS247,714025104247,SHRIVARSHA M,25CSED
25CS248,714025104248,SHUNMUGA IYYAPPAN S,25CSED
25CS249,714025104249,SINDHUJA SM,25CSED
25CS250,714025104250,SINTHANAIVALAVAN S,25CSED
25CS251,714025104251,SIVADARSHAN R,25CSEE
25CS252,714025104252,SIVAKUMAR S,25CSEE
25CS253,714025104253,SIVARANJANI M,25CSEE
25CS254,714025104254,SIVASANKARI S,25CSEE
25CS255,714025104255,SIVASURYA S,25CSEE
25CS256,714025104256,SNIYA M,25CSEE
25CS257,714025104257,SOWMIYA M,25CSEE
25CS258,714025104258,SREE HARISH M,25CSEE
25CS259,714025104259,SRI SANJAY KUMAR S,25CSEE
25CS260,714025104260,SRICHAND U S,25CSEE
25CS261,714025104261,SRIISHARAN S,25CSEE
25CS262,714025104262,SRIKAARTHEKA M,25CSEE
25CS263,714025104263,SRIMATHI G,25CSEE
25CS264,714025104264,SRIMATHI P,25CSEE
25CS265,714025104265,SRINITHI B,25CSEE
25CS266,714025104266,SRINITHI R J,25CSEE
25CS267,714025104267,SRIRAM D,25CSEE
25CS268,714025104268,SRISTHI N,25CSEE
25CS269,714025104269,SUBARANJANI G R,25CSEE
25CS270,714025104270,SUBHIKSHA V,25CSEE
25CS271,714025104271,SUBIKSHA S,25CSEE
25CS272,714025104272,SUBITHA S,25CSEE
25CS273,714025104273,SUDALAI MUTHU G,25CSEE
25CS274,714025104274,SUDEEP SANJAY M,25CSEE
25CS275,714025104275,SUGITHA G,25CSEE
25CS276,714025104276,SUJITH KUMAR S,25CSEE
25CS277,714025104277,SURIYA A M,25CSEE
25CS278,714025104278,SURIYA DHARSHINI S,25CSEE
25CS279,714025104279,SURJITH S,25CSEE
25CS280,714025104280,SURYA J,25CSEE
25CS281,714025104281,SURYA R,25CSEE
25CS282,714025104282,SUSILA M,25CSEE
25CS283,714025104283,SWATHI M,25CSEE
25CS284,714025104284,SWEDHA S,25CSEE
25CS285,714025104285,SWETHA A,25CSEE
25CS286,714025104286,TAMILARASI B,25CSEE
25CS287,714025104287,TARUN PRANAV RS,25CSEE
25CS288,714025104288,TARUNIKA RAJAGOPAL,25CSEE
25CS289,714025104289,TAUSIQ L,25CSEE
25CS290,714025104290,THARANITHARAN M,25CSEE
25CS291,714025104291,THARUN B,25CSEE
25CS292,714025104292,THARUNIKAA T,25CSEE
25CS293,714025104293,THENMOZHI K,25CSEE
25CS294,714025104294,THISANTHAN P,25CSEE
25CS295,714025104295,THRISHALA A,25CSEE
25CS296,714025104296,THRISHNA R,25CSEE
25CS297,714025104297,UGESH A,25CSEE
25CS298,714025104298,VAIRA AATHEESH S,25CSEE
25CS299,714025104299,VAISHNAVI K,25CSEE
25CS300,714025104300,VAISHNAVI S,25CSEE
25CS301,714025104301,VAISNIHAA S,25CSEE
25CS302,714025104302,VARSHINI R,25CSEE
25CS303,714025104303,VASANTHA MANI S,25CSEE
25CS304,714025104304,VEERAMANI N,25CSEE
25CS305,714025104305,VETRI VEL A,25CSEE
25CS306,714025104306,VIBIN D,25CSEE
25CS307,714025104307,VIDHYA VARSAN M,25CSEE
25CS308,714025104308,VIHASHINI R,25CSEE
25CS309,714025104309,VIJAY RATHINAM M,25CSEE
25CS310,714025104310,VIKASH S,25CSEE
25CS311,714025104311,VINITHA J,25CSEE
25CS312,714025104312,VISHWANATH N,25CSEE
25CS313,714025104313,YUVAN D,25CSEE"""

FACULTY_CSV_DATA = """Faculty name,Assigned Classes,Advising Class,Subjects
Dr. Beryl En Bink,CSE D,,Discrete Mathematics And Graph Theory
Dr. Devi,"CSE B, CSE D",,Tamils and Technology
Dr.C.Infant Vinoth,CSE E,,Engineering Exploration II(EEPL)
Dr.G.Perumalsamy,CSE D,,Design Thinking Engineering Laboratory
Dr.Kannammal,"CSE C, CSE D, CSE E",,Data Structures and Algorithms  I
Dr.Manokaran,"CSE A, CSE B, CSE C, CSE D, CSE E",,Design Thinking Engineering Laboratory
Dr.N.Ganesh,CSE E,,Design Thinking Engineering Laboratory
Dr.Senthilkumar,CSE B,,Engineering Exploration II(EEPL)
Dr.T.Sathish Kumar,CSE B,,Design Thinking Engineering Laboratory
Dr.Y Baby Kalpana,CSE D,,Web  Programming laboratory
Mr Subramaniam,CSE B,,Advanced JAVA Programming Lab
Mr. Sanjay Krishna,CSE C,CSE C,Web Programming Concepts
Mr.G.Anandababu,CSE D,,Engineering Exploration II(EEPL)
Mr.M.Karthik,CSE A,,Design Thinking Engineering Laboratory
Mr.M.Mohamed Rajik,CSE E,,Discrete Mathematics And Graph Theory
Mr.V.Balaji,CSE C,,Design Thinking Engineering Laboratory
Mrs Deepthi,CSE B,,Web Programming Concepts
Mrs Dhivya,"CSE A, CSE B, CSE C",,"Advanced JAVA Programming, Advanced JAVA Programming Lab"
Mrs Manimegalai,"CSE D, CSE E",,Data Structures and Algorithms  lab
Mrs Sharmila,CSE C,,Web  Programming laboratory
Mrs. Hemaprabha,"CSE D, CSE E",,"Advanced JAVA Programming, Advanced JAVA Programming Lab"
Mrs.A.R.Sweatha,CSE B,,Discrete Mathematics And Graph Theory
Mrs.M.Janani,"CSE A, CSE C",,Engineering Exploration II(EEPL)
Mrs.T.Saraswathi,CSE C,,Discrete Mathematics And Graph Theory
Ms Haritha,"CSE D, CSE E",,Web Programming Concepts
Ms Kalaiyarasi,CSE C,,Advanced JAVA Programming Lab
Ms Sasikala,"CSE B, CSE C",,Data Structures and Algorithms  lab
Ms Snega,"CSE A, CSE B, CSE C, CSE D, CSE E",,Psychology
Ms. Evangeline Aishwarya,,CSE D,
Ms. Gayathri,,CSE B,
Ms. Kousalya,"CSE A, CSE D, CSE E",,"English for Career Growth, Personality Development"
Ms. Padmini,CSE C,,"English for Career Growth, Personality Development"
Ms. Rajalakshmi Nagarajan,CSE B,,"English for Career Growth, Personality Development"
Ms. Rathina V,CSE E,,Tamils and Technology
Ms. S. Nandhini,CSE E,CSE E,Web  Programming laboratory
Ms. SangeethaV,"CSE A, CSE C",,Tamils and Technology
Ms. Sri devi,CSE D,,English for Career Growth
Ms.G.Nandhini devi,CSE A,,Discrete Mathematics And Graph Theory
Ms.Jenifer,"CSE A, CSE B, CSE E",CSE A,"Web  Programming laboratory, Web Programming Concepts"
Ms.Sasikala,"CSE A, CSE B",,"Data Structures and Algorithms  I, Data Structures and Algorithms  lab"
"""

def normalize_subject_name(name):
    """Normalize subject name by removing extra spaces."""
    return ' '.join(name.split())

def map_class_name(csv_name):
    """Map 'CSE A' -> '25CSEA'"""
    if not csv_name:
        return None
    csv_name = csv_name.strip()
    match = re.search(r'CSE\s+([A-E])', csv_name)
    if match:
        return f"25CSE{match.group(1)}"
    return csv_name

def clean_email(name):
    """Generate a clean email from name."""
    # Remove honorifics like Dr., Mrs., Ms., Mr.
    clean = re.sub(r'^(Dr\.|Mrs\.|Ms\.|Mr\.|Dr|Mrs|Ms|Mr)\s*', '', name)
    clean = clean.split(',')[0] # Remove degrees if commonly present
    clean = re.sub(r'[^a-zA-Z0-9]', '.', clean).lower()
    clean = re.sub(r'\.+', '.', clean).strip('.')
    return f"{clean}@attmate.com"

def seed():
    db = SessionLocal()
    try:
        # Clear existing data
        print("Clearing database (STARTING FROM ZERO)...")
        models.Base.metadata.drop_all(bind=engine)
        models.Base.metadata.create_all(bind=engine)

        # ------------------- 1. PARSE DATA -------------------
        print("Parsing Faculty CSV...")
        f_csv = io.StringIO(FACULTY_CSV_DATA)
        reader = csv.DictReader(f_csv)
        
        parsed_faculty_map = {} # email -> data
        all_subject_names = set()
        
        for row in reader:
            f_name = row['Faculty name']
            email = clean_email(f_name)
            
            # Parse Assigned Classes
            assigned_raw = row['Assigned Classes']
            assigned_classes = []
            if assigned_raw:
                parts = [p.strip() for p in assigned_raw.split(',')]
                assigned_classes = [map_class_name(p) for p in parts if p.strip()]
            
            # Parse Advising Class
            advising = map_class_name(row['Advising Class'])
            
            # Parse Subjects
            subjects_raw = row['Subjects']
            subjects = []
            if subjects_raw:
                parts = [p.strip() for p in subjects_raw.split(',')]
                for p in parts:
                    norm_name = normalize_subject_name(p)
                    if norm_name:
                        subjects.append(norm_name)
                        all_subject_names.add(norm_name)
            
            if email in parsed_faculty_map:
                # Merge logic
                existing = parsed_faculty_map[email]
                # Combine assigned classes
                existing['assigned_classes'].extend(assigned_classes)
                # Ensure unique
                existing['assigned_classes'] = list(set(existing['assigned_classes']))
                
                # Combine subjects (assume they teach all listed subjects to all listed classes for now)
                existing['subjects'].extend(subjects)
                existing['subjects'] = list(set(existing['subjects']))
                
                # Assign advisor if missing
                if advising and not existing['advising_class']:
                    existing['advising_class'] = advising
                    
                print(f"Merged duplicate for {f_name} ({email})")
            else:
                parsed_faculty_map[email] = {
                    'name': f_name,
                    'assigned_classes': assigned_classes,
                    'advising_class': advising,
                    'subjects': subjects,
                    'email': email
                }
            
        print(f"Found {len(all_subject_names)} unique subjects.")
        print(f"Found {len(parsed_faculty_map)} unique faculty members.")

        # ------------------- 2. SEED SUBJECTS -------------------
        print("Seeding Subjects...")
        created_subjects = {}
        for sub_name in all_subject_names:
            # Generate a code
            code = "".join([w[0] for w in sub_name.split()]).upper()[:5] + str(random.randint(100, 999))
            
            s = models.Subject(name=sub_name, code=code)
            db.add(s)
            db.commit()
            db.refresh(s)
            created_subjects[s.name] = s

        # ------------------- 3. SEED CLASSES -------------------
        print("Seeding Classes...")
        created_classes = {}
        for c_data in CLASSES_DATA:
            c = models.Class(name=c_data['name'])
            db.add(c)
            db.commit()
            db.refresh(c)
            created_classes[c.name] = c

        # ------------------- 4. SEED FACULTY & ASSIGNMENTS -------------------
        print("Seeding Faculty & Assignments...")
        
        # Admin
        admin = models.User(email='admin@attmate.com', password='123', role='admin')
        db.add(admin)
        
        for email, f_data in parsed_faculty_map.items():
            # Create User
            user = models.User(email=f_data['email'], password='123', role='teacher')
            db.add(user)
            db.commit()
            db.refresh(user)
            
            # Create Faculty Profile
            profile = models.Faculty(user_id=user.id, name=f_data['name'], department='CSE') 
            db.add(profile)
            db.commit()
            db.refresh(profile)
            
            # Link Advisor
            if f_data['advising_class']:
                cls = created_classes.get(f_data['advising_class'])
                if cls:
                    cls.advisor_id = profile.id
                    db.add(cls)
            
            # Assign Subjects
            for cls_name in f_data['assigned_classes']:
                cls = created_classes.get(cls_name)
                if not cls: continue
                
                for sub_name in f_data['subjects']:
                    sub = created_subjects.get(sub_name)
                    if sub:
                        assignment = models.FacultySubject(
                            faculty_id=profile.id,
                            subject_id=sub.id,
                            class_id=cls.id
                        )
                        db.add(assignment)
        db.commit()

        # ------------------- 5. SEED STUDENTS -------------------
        print("Seeding Students from embedded CSV...")
        
        f_csv = io.StringIO(STUDENT_CSV_DATA)
        reader = csv.DictReader(f_csv)
        
        count = 0
        for row in reader:
            roll = row['ROLL_NO']
            reg = row['REG_NO']
            name = row['NAME']
            cls_name = row['CLASS']
            
            class_obj = created_classes.get(cls_name)
            if not class_obj:
                continue
                
            student = models.Student(
                roll_number=roll,
                reg_number=reg,
                name=name,
                class_id=class_obj.id
            )
            db.add(student)
            count += 1
            
        db.commit()
        print(f"Successfully seeded {count} students.")
        print("Database reset successfully!")

    except Exception as e:
        print(f"Error seeding database: {e}")
        db.rollback()
    finally:
        db.close()

if __name__ == "__main__":
    seed()
